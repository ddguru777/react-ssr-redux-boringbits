{"version":3,"sources":["../../src/node_modules/app-module-path.js"],"names":["Module","require","nodePath","appModulePaths","old_nodeModulePaths","_nodeModulePaths","allowedDirs","checkIfDirAllowed","from","currentDir","indexOf","basename","parentDir","dirname","paths","call","concat","enableForDir","dir","addPath","path","parent","addPathHelper","targetArray","normalize","push","main","module","removePath","removePathHelper","index","splice","exports"],"mappings":"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","sourcesContent":["var Module = require('module').Module;\nvar nodePath = require('path');\n\nvar appModulePaths = [];\nvar old_nodeModulePaths = Module._nodeModulePaths;\nvar allowedDirs = {};\n\nfunction checkIfDirAllowed(from) {\n    var currentDir = from;\n\n    if (currentDir.indexOf('/boringbits/')>0) {\n        return true;\n    }\n\n    while (currentDir) {\n        if (allowedDirs[currentDir]) {\n            return true;\n        }\n\n        var basename = nodePath.basename(currentDir);\n        if (basename === 'node_modules') {\n            return false;\n        }\n\n        var parentDir = nodePath.dirname(currentDir);\n        if (parentDir === currentDir) {\n            break;\n        }\n        currentDir = parentDir;\n    }\n\n    return true;\n}\n\nModule._nodeModulePaths = function(from) {\n    var paths = old_nodeModulePaths.call(this, from);\n\n    // Only include the app module path for top-level modules\n    // that were not installed or that were explicitly allowed\n    if (checkIfDirAllowed(from)) {\n        paths = paths.concat(appModulePaths);\n    }\n\n    return paths;\n};\n\nfunction enableForDir(dir) {\n    allowedDirs[dir] = true;\n}\n\nfunction addPath(path, parent) {\n    // Anable app-module-path to work under any directories that are explicitly added\n    enableForDir(path);\n\n    function addPathHelper(targetArray) {\n        path = nodePath.normalize(path);\n        if (targetArray && targetArray.indexOf(path) === -1) {\n            targetArray.push(path);\n        }\n    }\n\n    path = nodePath.normalize(path);\n\n    if (appModulePaths.indexOf(path) === -1) {\n        appModulePaths.push(path);\n        // Enable the search path for the current top-level module\n        if (require.main) {\n            addPathHelper(require.main.paths);\n        }\n\n        parent = parent || module.parent;\n\n        // Also modify the paths of the module that was used to load the app-module-paths module\n        // and all of it's parents\n        while(parent && parent !== require.main) {\n            addPathHelper(parent.paths);\n            parent = parent.parent;\n        }\n    }\n}\n\nfunction removePath(path) {\n    function removePathHelper(targetArray) {\n        path = nodePath.normalize(path);\n        if (!targetArray) return;\n        var index = targetArray.indexOf(path);\n        if (index === -1) return;\n        targetArray.splice(index, 1);\n    }\n\n    var parent;\n    path = nodePath.normalize(path);\n    var index = appModulePaths.indexOf(path);\n\n    if (index > -1) {\n        appModulePaths.splice(index, 1);\n        // Enable the search path for the current top-level module\n        if (require.main) removePathHelper(require.main.paths);\n        parent = module.parent;\n\n        // Also modify the paths of the module that was used to load the app-module-paths module\n        // and all of it's parents\n        while(parent && parent !== require.main) {\n            removePathHelper(parent.paths);\n            parent = parent.parent;\n        }\n    }\n}\n\nexports.addPath = addPath;\nexports.removePath = removePath;\nexports.enableForDir = enableForDir;\n"],"file":"app-module-path.js"}