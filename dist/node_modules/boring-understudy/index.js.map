{"version":3,"sources":["../../../src/node_modules/boring-understudy/index.js"],"names":["UnderstudyBase","require","Understudy","call","self","perform","promiseifyPeform","args","Promise","resolve","reject","work","pop","push","workWrapper","next","workPromise","workResolve","then","workArgs","unshift","apply","catch","e","finalCallback","finalArgs","err","length","shift","undefined","before","promisifyBefore","wrappedFn","proxyFn","proxyArgs","promise","after","promisifyafter","module","exports"],"mappings":"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","sourcesContent":["const UnderstudyBase = require('understudy');\n\nfunction Understudy() {\n  UnderstudyBase.call(this);\n\n  const self = this;\n  const perform = this.perform;\n  this.perform = function promiseifyPeform(...args) {\n\n    return new Promise((resolve, reject) => {\n\n      let work = args.pop();\n      args.push(function workWrapper(next) {\n\n        try {\n          let workPromise = work();\n          if (!(workPromise instanceof Promise)) {\n            // wrap return value in promise\n            workPromise = new Promise(workResolve => workResolve(workPromise));\n          }\n\n          workPromise.then(function(...workArgs) {\n            workArgs.unshift(null);\n            next.apply(null, workArgs);\n          }).catch(next);\n        } catch(e) {\n          next(e);\n        }\n\n      });\n\n      args.push(function finalCallback(...finalArgs) {\n        const err = (finalArgs.length) ? finalArgs.shift() : undefined;\n\n        if (err) {\n          return reject(err);\n        }\n\n        resolve(finalArgs[0]);\n      })\n\n      perform.apply(self, args);\n    });\n  }\n\n  const before = this.before;\n  this.before = function promisifyBefore(...args) {\n    let wrappedFn = args.pop();\n    args.push(function proxyFn(...proxyArgs) {\n      let next = proxyArgs.pop();\n      try {\n        var promise = wrappedFn.apply(self, proxyArgs)\n        if (!(promise instanceof Promise)) promise = Promise.resolve(promise);\n        promise.then(next).catch(e => {\n          if (!e) e = 'err';\n          next(e);\n        });\n      } catch(e) {\n        next(e);\n      }\n    });\n\n    before.apply(self, args);\n  }\n\n  const after = this.after;\n  this.after = function promisifyafter(...args) {\n    let wrappedFn = args.pop();\n    args.push(function proxyFn(...proxyArgs) {\n      let next = proxyArgs.pop();\n      var promise = wrappedFn.apply(self, proxyArgs)\n      if (!(promise instanceof Promise)) promise = new Promise(resolve => resolve(promise));\n      promise.then(next).catch(e => {\n        if (!e) e = 'err';\n        next(e);\n      });\n    });\n\n    after.apply(self, args);\n  }\n\n}\n\nmodule.exports = Understudy;\n"],"file":"index.js"}