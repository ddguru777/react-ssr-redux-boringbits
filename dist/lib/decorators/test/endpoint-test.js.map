{"version":3,"sources":["../../../../src/lib/decorators/test/endpoint-test.js"],"names":["assert","require","logger","Emitter","injecture","Understudy","describe","endpoint_decortators","beforeEach","it","done","endpoint","get","getMetaDataByClass","Meow","bark","meow","classMetaData","metadata","equal","path","endpoints","methods","handler","prototype","middleware","post","entrypoint","screetch","stopper","deepEqual","subscribeDecorators","emitter1","wildcard","emitterCollecter1","on","args","push","eventName","event","Class1","Class2","length","instances","allInstances","ok","indexOf","Clazz","beep","console","log","clazz"],"mappings":"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","sourcesContent":["const assert = require('assert');\nconst logger = require('boring-logger');\nconst Emitter = require('eventemitter2');\nconst injecture = require('injecture');\nconst Understudy = require('boring-understudy');\n\n\ndescribe('Endpoint decorator', function() {\n\n  let endpoint_decortators;\n\n  beforeEach(() => {\n    endpoint_decortators = require('../router');\n  })\n\n\n  it('will push a prop into the class prototype', done => {\n    const { endpoint, get, getMetaDataByClass} = endpoint_decortators;\n\n    @endpoint('/foo')\n    class Meow {\n\n      @get('/beep')\n      bark() {\n\n      }\n\n      @get('/boop')\n      meow() {\n\n      }\n    }\n\n\n    const classMetaData = getMetaDataByClass(Meow).metadata;\n    assert.equal(classMetaData.path, '/foo');\n    assert.equal(classMetaData.endpoints.bark.path, '/beep');\n    assert.equal(classMetaData.endpoints.bark.methods.get.handler, Meow.prototype.bark);\n    assert.equal(classMetaData.endpoints.meow.path, '/boop');\n    assert.equal(classMetaData.endpoints.meow.methods.get.handler, Meow.prototype.meow);\n    done();\n  });\n\n\n  it('will combine annotations into the metadata', done => {\n    const { endpoint, get, middleware, post, entrypoint, getMetaDataByClass} = endpoint_decortators;\n\n    @endpoint('/bar')\n    class Meow {\n\n      @get('/beep')\n      @middleware('meep')\n      @entrypoint('foo_client.js')\n      screetch() {\n\n      }\n\n      @post('/beep')\n      stopper() {\n\n      }\n    }\n\n    const classMetaData = getMetaDataByClass(Meow).metadata;\n    assert.equal(classMetaData.endpoints.screetch.middleware[0], 'meep');\n    assert.equal(classMetaData.endpoints.screetch.path, '/beep');\n    assert.equal(classMetaData.endpoints.screetch.methods.get.handler, Meow.prototype.screetch);\n    assert.deepEqual(classMetaData.endpoints.screetch.methods.get.entrypoint, ['foo_client.js'])\n    assert.equal(classMetaData.endpoints.stopper.methods.post.handler, Meow.prototype.stopper);\n    done();\n  });\n\n\n  it('will reply all added decorated classes when a new emitter is added', done => {\n    const { endpoint, get, middleware, post, entrypoint, getMetaDataByClass, subscribeDecorators} = endpoint_decortators;\n\n    const emitter1 = new Emitter({wildcard: true});\n    const emitterCollecter1 = []\n\n    emitter1.on('decorator.router.*', function(...args) {\n      emitterCollecter1.push({\n        eventName: this.event,\n        args\n      });\n    })\n    subscribeDecorators(emitter1);\n\n    @endpoint('/foo')\n    class Class1 {\n\n    }\n\n\n    @endpoint('/bar')\n    class Class2 {\n\n    }\n\n    assert.equal(emitterCollecter1.length, 2, 'There should be two classes that were created');\n\n    const instances = injecture.allInstances('decorator.router.endpoint');\n\n    assert.ok(instances.indexOf(Class1) >= 0);\n    assert.ok(instances.indexOf(Class2) >= 0);\n    done();\n\n  })\n\n  it('will ensure get is actually wrapped', done => {\n    const { endpoint, get, middleware, post, entrypoint, getMetaDataByClass, subscribeDecorators} = endpoint_decortators;\n\n    @endpoint('/foo')\n    class Clazz {\n\n      @get('/bar')\n      beep() {\n        console.log('beep');\n      }\n    }\n\n    const clazz = new Clazz();\n    clazz.beep();\n\n    done();\n  });\n\n\n});"],"file":"endpoint-test.js"}